{% extends "base.html" %}

{% block content %}
<div class="container mx-auto p-4">
    <h1 class="text-2xl font-semibold mb-4">Chart of Accounts</h1>

    <!-- Filters -->
    <form method="get" class="mb-6 flex flex-wrap gap-4 items-end">
        <div>
            <label class="block text-sm font-medium">Account Type</label>
            <select name="account_type" class="border rounded px-3 py-2">
                <option value="">All</option>
                {% for key, value in account_types %}
                    <option value="{{ key }}" {% if account_type == key %}selected{% endif %}>{{ value }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium">Status</label>
            <select name="status" class="border rounded px-3 py-2">
                <option value="">All</option>
                <option value="active" {% if status == 'active' %}selected{% endif %}>Active</option>
                <option value="inactive" {% if status == 'inactive' %}selected{% endif %}>Inactive</option>
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium">Search</label>
            <input type="text" name="q" value="{{ search_query }}" class="border rounded px-3 py-2" placeholder="Name, code, or description">
        </div>
        <div>
            <label class="block text-sm font-medium">View Mode</label>
            <select name="tree" class="border rounded px-3 py-2">
                <option value="1" {% if show_tree %}selected{% endif %}>Tree</option>
                <option value="0" {% if not show_tree %}selected{% endif %}>Flat</option>
            </select>
        </div>
        <div>
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Filter</button>
        </div>
        <div>
            <a href="?export=1" class="bg-green-600 text-white px-4 py-2 rounded">Export CSV</a>
        </div>
    </form>

    <!-- Accounts Table -->
    <div class="overflow-x-auto bg-white rounded shadow">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-100 text-sm">
                <tr>
                    <th class="px-4 py-2 text-left">Code</th>
                    <th class="px-4 py-2 text-left">Name</th>
                    <th class="px-4 py-2 text-left">Type</th>
                    <th class="px-4 py-2 text-left">Status</th>
                    <th class="px-4 py-2 text-left">Parent</th>
                    <th class="px-4 py-2"></th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                {% for account in accounts %}
                <tr>
                    <td class="px-4 py-2 font-mono">{{ account.code }}</td>
                    <td class="px-4 py-2">{{ account.name }}</td>
                    <td class="px-4 py-2">{{ account.get_account_type_display }}</td>
                    <td class="px-4 py-2">
                        {% if account.is_active %}
                            <span class="text-green-600 font-semibold">Active</span>
                        {% else %}
                            <span class="text-red-600 font-semibold">Inactive</span>
                        {% endif %}
                    </td>
                    <td class="px-4 py-2">{{ account.parent.name if account.parent }}</td>
                    <td class="px-4 py-2 text-right">
                        <a href="{% url 'account_detail' account.id %}" class="text-blue-600 hover:underline">Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="px-4 py-4 text-center text-gray-500">No accounts found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
