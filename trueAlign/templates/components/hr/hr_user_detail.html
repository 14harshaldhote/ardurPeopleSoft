{% extends 'base.html' %}

{% block content %}
<!-- User Profile Section -->
<div class="max-w-7xl mx-auto py-8 px-4">
    <!-- Profile Header -->
    <div class="flex justify-between items-center mb-8">
        <div class="flex items-center space-x-4">
            <a href="{% url 'aps_hr:hr_dashboard' %}" class="text-blue-600 hover:text-blue-800">
                <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
            </a>
        </div>
    </div>

    <!-- User Profile Card -->
    <div class="bg-white rounded-xl shadow-md overflow-hidden">
        <!-- Profile Header -->
        <div class="bg-gradient-to-r from-blue-500 to-indigo-600 p-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div class="flex items-center space-x-4 mb-4 md:mb-0">
                    <div
                        class="h-16 w-16 rounded-full bg-white flex items-center justify-center text-xl font-bold text-indigo-600 shadow-md">
                        {{ user_obj.first_name|first|upper }}{{ user_obj.last_name|first|upper }}
                    </div>
                    <div class="text-white">
                        <h1 class="text-2xl font-bold">{{ user_obj.first_name }} {{ user_obj.last_name }}</h1>
                        <p class="text-blue-100">Employee ID: {{ user_obj.username }}</p>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-wrap gap-3"> <button type="button"
                        onclick="document.getElementById('changeStatusModal').style.display='block'"
                        class="px-4 py-2 bg-white text-indigo-600 rounded-lg hover:bg-indigo-50 transition-colors shadow-sm">
                        <i class="fas fa-exchange-alt mr-2"></i>Change Status </button> <button type="button"
                        onclick="document.getElementById('changeRoleModal').style.display='block'"
                        class="px-4 py-2 bg-white text-indigo-600 rounded-lg hover:bg-indigo-50 transition-colors shadow-sm">
                        <i class="fas fa-user-tag mr-2"></i>Change Role </button> <button type="button"
                        onclick="document.getElementById('resetPasswordModal').style.display='block'"
                        class="px-4 py-2 bg-white text-indigo-600 rounded-lg hover:bg-indigo-50 transition-colors shadow-sm">
                        <i class="fas fa-key mr-2"></i>Reset Password </button>
                </div>
            </div>
        </div>

        <!-- User Details -->
        <div class="p-6">
            <!-- Basic Information -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 pb-2 border-b">Basic Information</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Employee ID</p>
                        <p class="font-medium text-gray-800">{{ user_obj.username }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Full Name</p>
                        <p class="font-medium text-gray-800">{{ user_obj.first_name }} {{ user_obj.last_name }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Email</p>
                        <p class="font-medium text-gray-800">{{ user_obj.email|default:"-" }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Role</p>
                        <p class="font-medium text-gray-800">{{ user_obj.groups.first.name|default:"Employee" }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Status</p>
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium 
                            {% if user_detail.employment_status == 'active' %}bg-green-100 text-green-700
                            {% elif user_detail.employment_status == 'inactive' %}bg-gray-100 text-gray-700
                            {% elif user_detail.employment_status == 'terminated' %}bg-red-100 text-red-700
                            {% else %}bg-yellow-100 text-yellow-700{% endif %}">
                            <span class="w-2 h-2 rounded-full mr-2 
                                {% if user_detail.employment_status == 'active' %}bg-green-500
                                {% elif user_detail.employment_status == 'inactive' %}bg-gray-500
                                {% elif user_detail.employment_status == 'terminated' %}bg-red-500
                                {% else %}bg-yellow-500{% endif %}">
                            </span>
                            {{ user_detail.employment_status|title|default:"Unknown" }}
                        </span>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Account Active</p>
                        <p class="font-medium text-gray-800">{{ user_obj.is_active|yesno:"Yes,No" }}</p>
                    </div>
                </div>
            </div>

            <!-- Employment Information -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 pb-2 border-b">Employment Information</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Work Location</p>
                        <p class="font-medium text-gray-800">{{ user_detail.work_location|default:"-" }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Hire Date</p>
                        <p class="font-medium text-gray-800">{{ user_detail.hire_date|default:"-" }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Start Date</p>
                        <p class="font-medium text-gray-800">{{ user_detail.start_date|default:"-" }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Employment Duration</p>
                        <p class="font-medium text-gray-800">{{ user_detail.employment_duration|default:"-" }}</p>
                    </div>
                    <div class="col-span-full">
                        <p class="text-sm text-gray-500 mb-1">Job Description</p>
                        <p class="font-medium text-gray-800">{{ user_detail.job_description|default:"-" }}</p>
                    </div>
                </div>
            </div>

            <!-- Personal Details -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 pb-2 border-b">Personal Details</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Gender</p>
                        <p class="font-medium text-gray-800">{{ user_detail.gender|default:"-" }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Date of Birth</p>
                        <p class="font-medium text-gray-800">{{ user_detail.dob|default:"-" }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Blood Group</p>
                        <p class="font-medium text-gray-800">{{ user_detail.blood_group|default:"Unknown" }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Contact Number</p>
                        <p class="font-medium text-gray-800">{{ user_detail.contact_number_primary|default:"-" }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Personal Email</p>
                        <p class="font-medium text-gray-800">{{ user_detail.personal_email|default:"-" }}</p>
                    </div>
                </div>
            </div>

            <!-- Activity Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Recent Activity -->
                <div>
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800">Recent Activity</h2>
                        <a href="#" class="text-sm text-blue-600 hover:text-blue-800">View All</a>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-4">
                        <table class="min-w-full">
                            <thead>
                                <tr>
                                    <th
                                        class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider pb-3">
                                        Date</th>
                                    <th
                                        class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider pb-3">
                                        Action</th>
                                    <th
                                        class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider pb-3">
                                        By</th>
                                    <th
                                        class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider pb-3">
                                        Details</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if activity_logs %}
                                {% for log in activity_logs %}
                                <tr>
                                    <td class="py-2 text-sm text-gray-700">{{ log.date }}</td>
                                    <td class="py-2 text-sm text-gray-700">{{ log.action }}</td>
                                    <td class="py-2 text-sm text-gray-700">{{ log.by }}</td>
                                    <td class="py-2 text-sm text-gray-700">{{ log.details }}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="4" class="py-4 text-sm text-gray-500 text-center">No activity logs
                                        found</td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Login Sessions -->
                <div>
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800">Recent Login Sessions</h2>
                        <a href="#" class="text-sm text-blue-600 hover:text-blue-800">View All</a>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-4">
                        <table class="min-w-full">
                            <thead>
                                <tr>
                                    <th
                                        class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider pb-3">
                                        Login Time</th>
                                    <th
                                        class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider pb-3">
                                        Logout Time</th>
                                    <th
                                        class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider pb-3">
                                        Location</th>
                                    <th
                                        class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider pb-3">
                                        Duration</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if login_sessions %}
                                {% for session in login_sessions %}
                                <tr>
                                    <td class="py-2 text-sm text-gray-700">{{ session.login_time }}</td>
                                    <td class="py-2 text-sm text-gray-700">{{ session.logout_time }}</td>
                                    <td class="py-2 text-sm text-gray-700">{{ session.location }}</td>
                                    <td class="py-2 text-sm text-gray-700">{{ session.duration }}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="4" class="py-4 text-sm text-gray-500 text-center">No login sessions
                                        found</td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit User Details Section -->
    <div class="mt-8 bg-white rounded-xl shadow-md overflow-hidden">
        <div class="bg-gradient-to-r from-blue-500 to-indigo-600 p-4">
            <h2 class="text-xl font-semibold text-white">Edit User Details</h2>
        </div>
        <div class="p-6">
            <form action="{% url 'aps_hr:hr_user_detail' user_obj.id %}" method="post">
                {% csrf_token %}
                <!-- Basic Info -->
                <h3 class="text-lg font-medium text-gray-900 mb-3">Basic Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label for="first_name" class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                        <input type="text" id="first_name" name="first_name" value="{{ user_obj.first_name }}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="last_name" class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                        <input type="text" id="last_name" name="last_name" value="{{ user_obj.last_name }}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="email" name="email" value="{{ user_obj.email }}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>

                <!-- Employment Information -->
                <h3 class="text-lg font-medium text-gray-900 mb-3">Employment Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label for="work_location" class="block text-sm font-medium text-gray-700 mb-1">Work
                            Location</label>
                        <input type="text" id="work_location" name="work_location"
                            value="{{ user_detail.work_location }}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="hire_date" class="block text-sm font-medium text-gray-700 mb-1">Hire Date</label>
                        <input type="date" id="hire_date" name="hire_date"
                            value="{{ user_detail.hire_date|date:'Y-m-d' }}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="start_date" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                        <input type="date" id="start_date" name="start_date"
                            value="{{ user_detail.start_date|date:'Y-m-d' }}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="md:col-span-2">
                        <label for="job_description" class="block text-sm font-medium text-gray-700 mb-1">Job
                            Description</label>
                        <textarea id="job_description" name="job_description" rows="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">{{ user_detail.job_description }}</textarea>
                    </div>
                    <div>
                        <label for="employment_status" class="block text-sm font-medium text-gray-700 mb-1">Employment
                            Status</label>
                        <select id="employment_status" name="employment_status"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select Status</option>
                            {% for status_id, status_name in employment_status_choices %}
                            <option value="{{ status_id }}" {% if status_id == user_detail.employment_status %}selected{% endif %}>{{ status_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- Personal Details -->
                <h3 class="text-lg font-medium text-gray-900 mb-3">Personal Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label for="gender" class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
                        <select id="gender" name="gender"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select Gender</option>
                            {% for gender_id, gender_name in gender_choices %}
                            <option value="{{ gender_id }}" {% if gender_id == user_detail.gender %}selected{% endif %}>{{
                                gender_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="dob" class="block text-sm font-medium text-gray-700 mb-1">Date of Birth</label>
                        <input type="date" id="dob" name="dob" value="{{ user_detail.dob|date:'Y-m-d' }}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="blood_group" class="block text-sm font-medium text-gray-700 mb-1">Blood
                            Group</label>
                        <select id="blood_group" name="blood_group"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select Blood Group</option>
                            {% for bg_id, bg_name in blood_group_choices %}
                            <option value="{{ bg_id }}" {% if bg_id == user_detail.blood_group %}selected{% endif %}>
                                {{ bg_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="country_code" class="block text-sm font-medium text-gray-700 mb-1">Country
                            Code</label>
                        <input type="text" id="country_code" name="country_code" value="{{ user_detail.country_code }}"
                            placeholder="+91"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="contact_number_primary" class="block text-sm font-medium text-gray-700 mb-1">Contact
                            Number</label>
                        <input type="text" id="contact_number_primary" name="contact_number_primary"
                            value="{{ user_detail.contact_number_primary }}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="personal_email" class="block text-sm font-medium text-gray-700 mb-1">Personal
                            Email</label>
                        <input type="email" id="personal_email" name="personal_email"
                            value="{{ user_detail.personal_email }}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="panno" class="block text-sm font-medium text-gray-700 mb-1">PAN Number</label>
                        <input type="text" id="panno" name="panno" value="{{ user_detail.panno }}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="aadharno" class="block text-sm font-medium text-gray-700 mb-1">Aadhar Number</label>
                        <input type="text" id="aadharno" name="aadharno" value="{{ user_detail.aadharno }}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>

                <!-- Emergency Contact -->
                <h3 class="text-lg font-medium text-gray-900 mb-3">Emergency Contact</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label for="emergency_contact_name" class="block text-sm font-medium text-gray-700 mb-1">Contact
                            Name</label>
                        <input type="text" id="emergency_contact_name" name="emergency_contact_name"
                            value="{{ user_detail.emergency_contact_name }}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="emergency_country_code" class="block text-sm font-medium text-gray-700 mb-1">Country
                            Code</label>
                        <input type="text" id="emergency_country_code" name="emergency_country_code"
                            value="{{ user_detail.emergency_country_code }}" placeholder="+91"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="emergency_contact_primary"
                            class="block text-sm font-medium text-gray-700 mb-1">Contact Number</label>
                        <input type="text" id="emergency_contact_primary" name="emergency_contact_primary"
                            value="{{ user_detail.emergency_contact_primary }}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="md:col-span-3">
                        <label for="emergency_contact_address"
                            class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                        <textarea id="emergency_contact_address" name="emergency_contact_address" rows="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">{{ user_detail.emergency_contact_address }}</textarea>
                    </div>
                </div>

                <div class="flex justify-end">
                    <button type="submit"
                        class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors shadow-sm">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modals -->
<!-- Modals -->
<!-- Change Status Modal -->
<div id="changeStatusModal" class="modal"
    style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
    <div class="modal-content"
        style="background-color: #fefefe; margin: 10% auto; padding: 0; border: 1px solid #888; width: 50%; max-width: 500px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        <div class="modal-header"
            style="padding: 15px; background: linear-gradient(to right, #3b82f6, #4f46e5); color: white; border-top-left-radius: 8px; border-top-right-radius: 8px;">
            <h5 style="margin: 0; font-size: 1.25rem; font-weight: 600;">Change Employment Status</h5>
            <span class="close" onclick="document.getElementById('changeStatusModal').style.display='none'"
                style="color: white; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
        </div>
        <div class="modal-body" style="padding: 20px;">
            <form action="{% url 'aps_hr:change_user_status' user.id %}" method="post">
                {% csrf_token %}
                <div style="margin-bottom: 15px;">
                    <label for="current_status"
                        style="display: block; margin-bottom: 5px; font-size: 0.875rem; font-weight: 500; color: #374151;">Current
                        Status</label>
                    <input type="text" id="current_status"
                        value="{{ user.userdetails.employment_status|title|default:'None' }}"
                        style="width: 100%; padding: 8px 12px; background-color: #f3f4f6; border: 1px solid #d1d5db; border-radius: 6px;"
                        readonly>
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="status"
                        style="display: block; margin-bottom: 5px; font-size: 0.875rem; font-weight: 500; color: #374151;">New
                        Status</label>
                    <select id="status" name="status" required
                        style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;">
                        <option value="" selected disabled>Select Status</option>
                        {% for status_id, status_name in employment_status_choices %}
                        <option value="{{ status_id }}">{{ status_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="status_reason"
                        style="display: block; margin-bottom: 5px; font-size: 0.875rem; font-weight: 500; color: #374151;">Reason
                        for Change</label>
                    <textarea id="status_reason" name="reason" rows="3" required
                        style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;"></textarea>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" onclick="document.getElementById('changeStatusModal').style.display='none'"
                        style="padding: 8px 16px; border: 1px solid #d1d5db; background-color: white; color: #374151; border-radius: 6px; cursor: pointer;">
                        Cancel
                    </button>
                    <button type="submit"
                        style="padding: 8px 16px; background-color: #4f46e5; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Change Role Modal -->
<div id="changeRoleModal" class="modal"
    style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
    <div class="modal-content"
        style="background-color: #fefefe; margin: 10% auto; padding: 0; border: 1px solid #888; width: 50%; max-width: 500px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        <div class="modal-header"
            style="padding: 15px; background: linear-gradient(to right, #3b82f6, #4f46e5); color: white; border-top-left-radius: 8px; border-top-right-radius: 8px;">
            <h5 style="margin: 0; font-size: 1.25rem; font-weight: 600;">Change User Role</h5>
            <span class="close" onclick="document.getElementById('changeRoleModal').style.display='none'"
                style="color: white; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
        </div>
        <div class="modal-body" style="padding: 20px;">
            <form action="{% url 'aps_hr:change_user_role' user.id %}" method="post">
                {% csrf_token %}
                <div style="margin-bottom: 15px;">
                    <label for="current_role"
                        style="display: block; margin-bottom: 5px; font-size: 0.875rem; font-weight: 500; color: #374151;">Current
                        Role</label>
                    <input type="text" id="current_role" value="{{ user.userdetails.role|default:'Employee' }}"
                        style="width: 100%; padding: 8px 12px; background-color: #f3f4f6; border: 1px solid #d1d5db; border-radius: 6px;"
                        readonly>
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="group"
                        style="display: block; margin-bottom: 5px; font-size: 0.875rem; font-weight: 500; color: #374151;">New
                        Role</label>
                    <select id="group" name="group" required
                        style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;">
                        <option value="" selected disabled>Select Role</option>
                        {% for group in groups %}
                        <option value="{{ group.id }}">{{ group.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="role_reason"
                        style="display: block; margin-bottom: 5px; font-size: 0.875rem; font-weight: 500; color: #374151;">Reason
                        for Change</label>
                    <textarea id="role_reason" name="reason" rows="3" required
                        style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;"></textarea>
                </div>
                <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 15px;">
                    <p>Changing a user's role will affect their permissions and access levels in the system.</p>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" onclick="document.getElementById('changeRoleModal').style.display='none'"
                        style="padding: 8px 16px; border: 1px solid #d1d5db; background-color: white; color: #374151; border-radius: 6px; cursor: pointer;">
                        Cancel
                    </button>
                    <button type="submit"
                        style="padding: 8px 16px; background-color: #4f46e5; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Reset Password Modal -->
<div id="resetPasswordModal" class="modal"
    style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
    <div class="modal-content"
        style="background-color: #fefefe; margin: 10% auto; padding: 0; border: 1px solid #888; width: 50%; max-width: 500px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        <div class="modal-header"
            style="padding: 15px; background: linear-gradient(to right, #3b82f6, #4f46e5); color: white; border-top-left-radius: 8px; border-top-right-radius: 8px;">
            <h5 style="margin: 0; font-size: 1.25rem; font-weight: 600;">Reset User Password</h5>
            <span class="close" onclick="document.getElementById('resetPasswordModal').style.display='none'"
                style="color: white; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
        </div>
        <div class="modal-body" style="padding: 20px;">
            <form action="{% url 'aps_hr:reset_user_password' user.id %}" method="post" id="resetPasswordForm">
                {% csrf_token %}
                <div style="margin-bottom: 15px; text-align: center;">
                    <p style="color: #374151;">You are about to reset the password for: <strong>{{ user.userdetails.employee_id }}</strong></p>
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="new_password"
                        style="display: block; margin-bottom: 5px; font-size: 0.875rem; font-weight: 500; color: #374151;">New
                        Password</label>
                    <input type="password" id="new_password" name="new_password" required minlength="8"
                        style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;">
                    <p style="font-size: 0.75rem; color: #6b7280; margin-top: 4px;">Password must be at least 8
                        characters long.</p>
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="confirm_password"
                        style="display: block; margin-bottom: 5px; font-size: 0.875rem; font-weight: 500; color: #374151;">Confirm
                        Password</label>
                    <input type="password" id="confirm_password" name="confirm_password" required
                        style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;">
                    <p style="font-size: 0.75rem; color: #ef4444; margin-top: 4px; display: none;" id="password-mismatch">
                        Passwords do not match.</p>
                </div>
                <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 15px;">
                    <p>The user will receive an email with their new password.</p>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" onclick="document.getElementById('resetPasswordModal').style.display='none'"
                        style="padding: 8px 16px; border: 1px solid #d1d5db; background-color: white; color: #374151; border-radius: 6px; cursor: pointer;">
                        Cancel
                    </button>
                    <button type="submit"
                        style="padding: 8px 16px; background-color: #4f46e5; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        Reset Password
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Password validation
        const newPassword = document.getElementById('new_password');
        const confirmPassword = document.getElementById('confirm_password');
        const mismatchMessage = document.getElementById('password-mismatch');
        const resetForm = document.getElementById('resetPasswordForm');

        if (resetForm) {
            resetForm.addEventListener('submit', function (e) {
                if (newPassword.value !== confirmPassword.value) {
                    e.preventDefault();
                    mismatchMessage.style.display = 'block';
                } else {
                    mismatchMessage.style.display = 'none';
                }
            });
        }

        if (confirmPassword) {
            confirmPassword.addEventListener('input', function () {
                if (newPassword.value !== confirmPassword.value) {
                    mismatchMessage.style.display = 'block';
                } else {
                    mismatchMessage.style.display = 'none';
                }
            });
        }
    });
</script>
<script>
    $(document).ready(function () {
        // Ensure modals are hidden on page load
        $('.modal').modal('hide');

        // Setup button handlers
        $('#changeStatusBtn').click(function () {
            $('#changeStatusModal').modal('show');
        });

        $('#changeRoleBtn').click(function () {
            $('#changeRoleModal').modal('show');
        });

        $('#resetPasswordBtn').click(function () {
            $('#resetPasswordModal').modal('show');
        });

        // Password validation
        const newPassword = document.getElementById('new_password');
        const confirmPassword = document.getElementById('confirm_password');
        const mismatchMessage = document.getElementById('password-mismatch');
        const resetForm = document.getElementById('resetPasswordForm');

        if (resetForm) {
            resetForm.addEventListener('submit', function (e) {
                if (newPassword.value !== confirmPassword.value) {
                    e.preventDefault();
                    mismatchMessage.style.display = 'block';
                } else {
                    mismatchMessage.style.display = 'none';
                }
            });
        }

        if (confirmPassword) {
            confirmPassword.addEventListener('input', function () {
                if (newPassword.value !== confirmPassword.value) {
                    mismatchMessage.style.display = 'block';
                } else {
                    mismatchMessage.style.display = 'none';
                }
            });
        }
    });
</script>
{% endblock %}